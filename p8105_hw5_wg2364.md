Homework 5
================
Wenhao Gou
2020/11/12

``` r
knitr::opts_chunk$set(
  message = F,
  warning = F
)
library(tidyverse)
```

# Question 1:

## Include and tidy the data:

``` r
homocide <- read_csv("Dataset/homicide_data/homicide-data.csv")
homocide
```

    ## # A tibble: 52,179 x 12
    ##    uid   reported_date victim_last victim_first victim_race victim_age
    ##    <chr>         <dbl> <chr>       <chr>        <chr>       <chr>     
    ##  1 Alb-~      20100504 GARCIA      JUAN         Hispanic    78        
    ##  2 Alb-~      20100216 MONTOYA     CAMERON      Hispanic    17        
    ##  3 Alb-~      20100601 SATTERFIELD VIVIANA      White       15        
    ##  4 Alb-~      20100101 MENDIOLA    CARLOS       Hispanic    32        
    ##  5 Alb-~      20100102 MULA        VIVIAN       White       72        
    ##  6 Alb-~      20100126 BOOK        GERALDINE    White       91        
    ##  7 Alb-~      20100127 MALDONADO   DAVID        Hispanic    52        
    ##  8 Alb-~      20100127 MALDONADO   CONNIE       Hispanic    52        
    ##  9 Alb-~      20100130 MARTIN-LEY~ GUSTAVO      White       56        
    ## 10 Alb-~      20100210 HERRERA     ISRAEL       Hispanic    43        
    ## # ... with 52,169 more rows, and 6 more variables: victim_sex <chr>,
    ## #   city <chr>, state <chr>, lat <dbl>, lon <dbl>, disposition <chr>

The dataset have 52,179 rows and 12 columns. There are 10 variables in
the dataset:

  - `uid`: a character indicate the id of the case

  - `reported_date`: a number indicate the date of the case.

  - `victim_last` to `victim_sex`: indicate the information of the
    victim (first and last name, race, age and sex). All of these
    variables are character.

  - `city` and `state`: two character indicate the location of the case

  - `lat` and `lon`: two number indicate the latitude and longitude of
    the location

  - `disposition` : a character indicate the disposition of the case

Next, we want to create a `city_state` variable (e.g. “Baltimore, MD”)
and then summarize within cities to obtain the total number of homicides
and the number of unsolved homicides (those for which the disposition is
“Closed without arrest” or “Open/No arrest”)

``` r
homocide <- 
  homocide %>% 
  mutate(city_state = str_c(city, state, sep = "_")) %>% 
  mutate(result = case_when(
      disposition == "Closed without arrest" ~ "unsolved",
      disposition == "Open/No arrest"        ~ "unsolved",
      disposition == "Closed by arrest"      ~ "solved",
    )) 
homocide_summary <-
  homocide %>% 
  select(city_state, result) %>% 
  group_by(city_state) %>% 
  summarise(
    total_case = n(),
    total_unsolved = sum(result == "unsolved")
  )
homocide_summary
```

    ## # A tibble: 51 x 3
    ##    city_state     total_case total_unsolved
    ##    <chr>               <int>          <int>
    ##  1 Albuquerque_NM        378            146
    ##  2 Atlanta_GA            973            373
    ##  3 Baltimore_MD         2827           1825
    ##  4 Baton Rouge_LA        424            196
    ##  5 Birmingham_AL         800            347
    ##  6 Boston_MA             614            310
    ##  7 Buffalo_NY            521            319
    ##  8 Charlotte_NC          687            206
    ##  9 Chicago_IL           5535           4073
    ## 10 Cincinnati_OH         694            309
    ## # ... with 41 more rows

## Proportion test on Baltimore\_MD

We can firstly define a function to do all the jobs:

``` r
prop_test_ <- function(tibble_input){
  tibble_output <-
    tibble_input %>% 
    mutate(proptest = 
              map2(
                .x = pull(tibble_input, total_unsolved),
                .y = pull(tibble_input, total_case),
                ~prop.test(x = .x, n = .y))) %>% 
    mutate(tidytest = 
             map(
               .x = proptest, 
               ~broom::tidy(.x))) %>% 
    select(-proptest) %>% 
    unnest(tidytest) %>% 
    select(city_state, estimate, conf.low, conf.high)
  return(tibble_output)
}
```

Then, for Baltimore, MD

``` r
homocide_summary %>%
  filter(city_state == "Baltimore_MD") %>%
  prop_test_(.) 
```

    ## # A tibble: 1 x 4
    ##   city_state   estimate conf.low conf.high
    ##   <chr>           <dbl>    <dbl>     <dbl>
    ## 1 Baltimore_MD    0.646    0.628     0.663

## Run the test for all the city:

``` r
homocide_result <-
  homocide_summary %>% 
  prop_test_(.)
homocide_result
```

    ## # A tibble: 51 x 4
    ##    city_state     estimate conf.low conf.high
    ##    <chr>             <dbl>    <dbl>     <dbl>
    ##  1 Albuquerque_NM    0.386    0.337     0.438
    ##  2 Atlanta_GA        0.383    0.353     0.415
    ##  3 Baltimore_MD      0.646    0.628     0.663
    ##  4 Baton Rouge_LA    0.462    0.414     0.511
    ##  5 Birmingham_AL     0.434    0.399     0.469
    ##  6 Boston_MA         0.505    0.465     0.545
    ##  7 Buffalo_NY        0.612    0.569     0.654
    ##  8 Charlotte_NC      0.300    0.266     0.336
    ##  9 Chicago_IL        0.736    0.724     0.747
    ## 10 Cincinnati_OH     0.445    0.408     0.483
    ## # ... with 41 more rows

## The plot:

``` r
homocide_result %>% 
  mutate(city_state = fct_reorder(city_state, estimate)) %>% 
  filter(city_state != "Tulsa_AL") %>%   #Poor data with just 1 case
  ggplot(aes(x = city_state, y = estimate)) +
  geom_point() + 
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```

![](p8105_hw5_wg2364_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

# Question 2:

# Question 3:
